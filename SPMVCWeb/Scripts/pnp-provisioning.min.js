/**
 * sp-pnp-js v1.0.6 - A reusable JavaScript library targeting SharePoint client-side development.
 * MIT (https://github.com/OfficeDev/PnP-JS-Core/blob/master/LICENSE)
 * Copyright (c) 2016 Microsoft
 * docs: http://officedev.github.io/PnP-JS-Core
 * source: https://github.com/SharePoint/PnP-JS-Core
 * bugs: https://github.com/SharePoint/PnP-JS-Core/issues
 */
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,(t.$pnp||(t.$pnp={})).Provisioning=e()}}(function(){return function e(t,n,o){function r(s,a){if(!n[s]){if(!t[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(i)return i(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[s]={exports:{}};t[s][0].call(l.exports,function(e){var n=t[s][1][e];return r(n?n:e)},l,l.exports,e,t,n,o)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<o.length;s++)r(o[s]);return r}({1:[function(e,t,n){"use strict";var o=e("../utils/util"),r=function(){function e(){this.keys=[],this.values=[]}return e.prototype.get=function(e){var t=this.keys.indexOf(e);return t<0?null:this.values[t]},e.prototype.add=function(e,t){var n=this.keys.indexOf(e);n>-1?this.values[n]=t:(this.keys.push(e),this.values.push(t))},e.prototype.merge=function(e){if(o.Util.isFunction(e.getKeys))for(var t=e,n=t.getKeys(),r=n.length,i=0;i<r;i++)this.add(n[i],t.get(n[i]));else{var s=e;for(var a in s)s.hasOwnProperty(a)&&this.add(a,e[a])}},e.prototype.remove=function(e){var t=this.keys.indexOf(e);if(t<0)return null;var n=this.values[t];return this.keys.splice(t,1),this.values.splice(t,1),n},e.prototype.getKeys=function(){return this.keys},e.prototype.getValues=function(){return this.values},e.prototype.clear=function(){this.keys=[],this.values=[]},e.prototype.count=function(){return this.keys.length},e}();n.Dictionary=r},{"../utils/util":23}],2:[function(e,t,n){(function(e){"use strict";function t(e){r.set(e)}var o=function(){function t(){this._headers=null,this._defaultCachingStore="session",this._defaultCachingTimeoutSeconds=30,this._globalCacheDisable=!1,this._useSPRequestExecutor=!1}return t.prototype.set=function(t){t.hasOwnProperty("headers")&&(this._headers=t.headers),t.hasOwnProperty("globalCacheDisable")&&(this._globalCacheDisable=t.globalCacheDisable),t.hasOwnProperty("defaultCachingStore")&&(this._defaultCachingStore=t.defaultCachingStore),t.hasOwnProperty("defaultCachingTimeoutSeconds")&&(this._defaultCachingTimeoutSeconds=t.defaultCachingTimeoutSeconds),t.hasOwnProperty("useSPRequestExecutor")&&(this._useSPRequestExecutor=t.useSPRequestExecutor),t.hasOwnProperty("nodeClientOptions")&&(this._useNodeClient=!0,this._useSPRequestExecutor=!1,this._nodeClientData=t.nodeClientOptions,e._spPageContextInfo={webAbsoluteUrl:t.nodeClientOptions.siteUrl})},Object.defineProperty(t.prototype,"headers",{get:function(){return this._headers},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"defaultCachingStore",{get:function(){return this._defaultCachingStore},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"defaultCachingTimeoutSeconds",{get:function(){return this._defaultCachingTimeoutSeconds},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"globalCacheDisable",{get:function(){return this._globalCacheDisable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useSPRequestExecutor",{get:function(){return this._useSPRequestExecutor},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useNodeFetchClient",{get:function(){return this._useNodeClient},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nodeRequestOptions",{get:function(){return this._nodeClientData},enumerable:!0,configurable:!0}),t}();n.RuntimeConfigImpl=o;var r=new o;n.RuntimeConfig=r,n.setRuntimeConfig=t}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],3:[function(e,t,n){"use strict";var o=e("../collections/collections"),r=e("../utils/util"),i=e("../sharepoint/rest/odata"),s=function(){function e(){}return e}();n.CachedDigest=s;var a=function(){function e(e,t){void 0===t&&(t=new o.Dictionary),this._httpClient=e,this._digests=t}return e.prototype.getDigest=function(e){var t=this,n=this._digests.get(e);if(null!==n){var o=new Date;if(o<n.expiration)return Promise.resolve(n.value)}var a=r.Util.combinePaths(e,"/_api/contextinfo");return t._httpClient.fetchRaw(a,{cache:"no-cache",credentials:"same-origin",headers:{Accept:"application/json;odata=verbose","Content-type":"application/json;odata=verbose;charset=utf-8"},method:"POST"}).then(function(e){var t=new i.ODataDefaultParser;return t.parse(e).then(function(e){return e.GetContextWebInformation})}).then(function(n){var o=new s;o.value=n.FormDigestValue;var r=n.FormDigestTimeoutSeconds,i=new Date;return i.setTime(i.getTime()+1e3*r),o.expiration=i,t._digests.add(e,o),o.value})},e.prototype.clear=function(){this._digests.clear()},e}();n.DigestCache=a},{"../collections/collections":1,"../sharepoint/rest/odata":21,"../utils/util":23}],4:[function(e,t,n){(function(e){"use strict";var t=function(){function t(){}return t.prototype.fetch=function(t,n){return e.fetch(t,n)},t}();n.FetchClient=t}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],5:[function(e,t,n){"use strict";var o=e("./fetchclient"),r=e("./digestcache"),i=e("../utils/util"),s=e("../configuration/pnplibconfig"),a=e("./sprequestexecutorclient"),c=e("./nodefetchclient"),u=function(){function e(){this._impl=this.getFetchImpl(),this._digestCache=new r.DigestCache(this)}return e.prototype.fetch=function(e,t){void 0===t&&(t={});var n=this,o=i.Util.extend(t,{cache:"no-cache",credentials:"same-origin"},!0),r=new Headers;if(this.mergeHeaders(r,s.RuntimeConfig.headers),this.mergeHeaders(r,t.headers),r.has("Accept")||r.append("Accept","application/json"),r.has("Content-Type")||r.append("Content-Type","application/json;odata=verbose;charset=utf-8"),r.has("X-ClientService-ClientTag")||r.append("X-ClientService-ClientTag","PnPCoreJS:1.0.6"),o=i.Util.extend(o,{headers:r}),o.method&&"GET"!==o.method.toUpperCase()&&!r.has("X-RequestDigest")){var a=e.indexOf("_api/");if(a<0)throw new Error("Unable to determine API url");var c=e.substr(0,a);return this._digestCache.getDigest(c).then(function(t){return r.append("X-RequestDigest",t),n.fetchRaw(e,o)})}return n.fetchRaw(e,o)},e.prototype.fetchRaw=function(e,t){var n=this;void 0===t&&(t={});var o=new Headers;this.mergeHeaders(o,t.headers),t=i.Util.extend(t,{headers:o});var r=function(o){n._impl.fetch(e,t).then(function(e){return o.resolve(e)}).catch(function(e){var t=o.delay;429!==e.status&&503!==e.status&&o.reject(e),o.delay*=2,o.attempts++,o.retryCount<=o.attempts&&o.reject(e),setTimeout(i.Util.getCtxCallback(n,r,o),t)})};return new Promise(function(e,t){var o={attempts:0,delay:100,reject:t,resolve:e,retryCount:7};r.call(n,o)})},e.prototype.get=function(e,t){void 0===t&&(t={});var n=i.Util.extend(t,{method:"GET"});return this.fetch(e,n)},e.prototype.post=function(e,t){void 0===t&&(t={});var n=i.Util.extend(t,{method:"POST"});return this.fetch(e,n)},e.prototype.patch=function(e,t){void 0===t&&(t={});var n=i.Util.extend(t,{method:"PATCH"});return this.fetch(e,n)},e.prototype.delete=function(e,t){void 0===t&&(t={});var n=i.Util.extend(t,{method:"DELETE"});return this.fetch(e,n)},e.prototype.getFetchImpl=function(){if(s.RuntimeConfig.useSPRequestExecutor)return new a.SPRequestExecutorClient;if(s.RuntimeConfig.useNodeFetchClient){var e=s.RuntimeConfig.nodeRequestOptions;return new c.NodeFetchClient(e.siteUrl,e.clientId,e.clientSecret)}return new o.FetchClient},e.prototype.mergeHeaders=function(e,t){if("undefined"!=typeof t&&null!==t){var n=new Request("",{headers:t});n.headers.forEach(function(t,n){e.append(n,t)})}},e}();n.HttpClient=u},{"../configuration/pnplibconfig":2,"../utils/util":23,"./digestcache":3,"./fetchclient":4,"./nodefetchclient":6,"./sprequestexecutorclient":7}],6:[function(e,t,n){"use strict";var o=function(){function e(e,t,n,o){void 0===o&&(o=""),this.siteUrl=e,this._clientId=t,this._clientSecret=n,this._realm=o}return e.prototype.fetch=function(e,t){throw new Error("Using NodeFetchClient in the browser is not supported.")},e}();n.NodeFetchClient=o},{}],7:[function(e,t,n){"use strict";var o=e("../utils/util"),r=function(){function e(){this.convertToResponse=function(e){var t=new Headers;for(var n in e.headers)e.headers[n]&&t.append(n,e.headers[n]);return new Response(e.body,{headers:t,status:e.statusCode,statusText:e.statusText})}}return e.prototype.fetch=function(e,t){var n=this;if("undefined"==typeof SP||"undefined"==typeof SP.RequestExecutor)throw new Error("SP.RequestExecutor is undefined. Load the SP.RequestExecutor.js library (/_layouts/15/SP.RequestExecutor.js) before loading the PnP JS Core library.");var r,i,s=e.substring(0,e.indexOf("/_api")),a=new SP.RequestExecutor(s),c={};if(t.headers&&t.headers instanceof Headers)for(r=t.headers.entries(),i=r.next();!i.done;)c[i.value[0]]=i.value[1],i=r.next();else c=t.headers;return new Promise(function(r,i){var s={error:function(e){i(n.convertToResponse(e))},headers:c,method:t.method,success:function(e){r(n.convertToResponse(e))},url:e};t.body?o.Util.extend(s,{body:t.body}):o.Util.extend(s,{binaryStringRequestBody:!0}),a.executeAsync(s)})},e}();n.SPRequestExecutorClient=r},{"../utils/util":23}],8:[function(e,t,n){"use strict";var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},r=e("../util"),i=e("./objecthandlerbase"),s=function(e){function t(){e.call(this,"ComposedLook")}return o(t,e),t.prototype.ProvisionObjects=function(t){var n=this;return e.prototype.scope_started.call(this),new Promise(function(o,i){var s=SP.ClientContext.get_current(),a=s.get_web(),c=t.ColorPaletteUrl?r.Util.replaceUrlTokens(t.ColorPaletteUrl):"",u=t.FontSchemeUrl?r.Util.replaceUrlTokens(t.FontSchemeUrl):"",l=t.BackgroundImageUrl?r.Util.replaceUrlTokens(t.BackgroundImageUrl):null;a.applyTheme(r.Util.getRelativeUrl(c),r.Util.getRelativeUrl(u),l,!0),a.update(),s.executeQueryAsync(function(){e.prototype.scope_ended.call(n),o()},function(){e.prototype.scope_ended.call(n),o()})})},t}(i.ObjectHandlerBase);n.ObjectComposedLook=s},{"../util":20,"./objecthandlerbase":12}],9:[function(e,t,n){"use strict";var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},r=e("./objecthandlerbase"),i=function(e){function t(){e.call(this,"CustomActions")}return o(t,e),t.prototype.ProvisionObjects=function(t){var n=this;return e.prototype.scope_started.call(this),new Promise(function(o,r){var i=SP.ClientContext.get_current(),s=i.get_web().get_userCustomActions();i.load(s),i.executeQueryAsync(function(){t.forEach(function(e){var t=s.get_data().filter(function(t){return t.get_title()===e.Title}).length>0;if(!t){var n=s.add();e.Description&&n.set_description(e.Description),e.CommandUIExtension&&n.set_commandUIExtension(e.CommandUIExtension),e.Group&&n.set_group(e.Group),e.Title&&n.set_title(e.Title),e.Url&&n.set_url(e.Url),e.ScriptBlock&&n.set_scriptBlock(e.ScriptBlock),e.ScriptSrc&&n.set_scriptSrc(e.ScriptSrc),e.Location&&n.set_location(e.Location),e.ImageUrl&&n.set_imageUrl(e.ImageUrl),e.Name&&n.set_name(e.Name),e.RegistrationId&&n.set_registrationId(e.RegistrationId),e.RegistrationType&&n.set_registrationType(e.RegistrationType),e.Rights&&n.set_rights(e.Rights),e.Sequence&&n.set_sequence(e.Sequence),n.update()}}),i.executeQueryAsync(function(){e.prototype.scope_ended.call(n),o()},function(){e.prototype.scope_ended.call(n),o()})},function(){e.prototype.scope_ended.call(n),o()})})},t}(r.ObjectHandlerBase);n.ObjectCustomActions=i},{"./objecthandlerbase":12}],10:[function(e,t,n){"use strict";var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},r=e("./objecthandlerbase"),i=function(e){function t(){e.call(this,"Features")}return o(t,e),t.prototype.ProvisionObjects=function(t){var n=this;return e.prototype.scope_started.call(this),new Promise(function(o,r){var i=SP.ClientContext.get_current(),s=i.get_web(),a=s.get_features();t.forEach(function(e){e.Deactivate===!0?a.remove(new SP.Guid(e.ID),!0):a.add(new SP.Guid(e.ID),!0,SP.FeatureDefinitionScope.none)}),s.update(),i.load(a),i.executeQueryAsync(function(){e.prototype.scope_ended.call(n),o()},function(){e.prototype.scope_ended.call(n),o()})})},t}(r.ObjectHandlerBase);n.ObjectFeatures=i},{"./objecthandlerbase":12}],11:[function(e,t,n){"use strict";var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},r=e("../../../utils/util"),i=e("../util"),s=e("./objecthandlerbase"),a=function(e){function t(){e.call(this,"Files")}return o(t,e),t.prototype.ProvisionObjects=function(t){var n=this;return e.prototype.scope_started.call(this),new Promise(function(o,s){var a=SP.ClientContext.get_current(),c=a.get_web(),u=[],l=[];t.forEach(function(e,t){l.push(n.httpClient.fetchRaw(i.Util.replaceUrlTokens(e.Src)).then(function(e){return e.text()}))}),Promise.all(l).then(function(e){e.forEach(function(e,o){var i=t[o],s=n.GetFilenameFromFilePath(i.Dest),l=_spPageContextInfo.webServerRelativeUrl,p=c.getFolderByServerRelativeUrl(l+"/"+n.GetFolderFromFilePath(i.Dest)),f={Contents:e,Dest:i.Dest,Filename:s,Folder:p,Instance:null,Overwrite:!1,Properties:[],RemoveExistingWebParts:!0,ServerRelativeUrl:i.Dest,Src:i.Src,Views:[],WebParts:[]};if(r.Util.extend(f,i),f.Filename.indexOf("Form.aspx")===-1){var d=new SP.FileCreationInformation;d.set_overwrite(f.Overwrite),d.set_url(f.Filename),d.set_content(new SP.Base64EncodedByteArray);for(var h=0;h<f.Contents.length;h++)d.get_content().append(f.Contents.charCodeAt(h));a.load(f.Folder.get_files().add(d)),u.push(f)}})}),a.executeQueryAsync(function(){l=[],u.forEach(function(e){e.Properties&&Object.keys(e.Properties).length>0&&l.push(n.ApplyFileProperties(e.Dest,e.Properties)),e.WebParts&&e.WebParts.length>0&&l.push(n.AddWebPartsToWebPartPage(e.Dest,e.Src,e.WebParts,e.RemoveExistingWebParts))}),Promise.all(l).then(function(){n.ModifyHiddenViews(t).then(function(t){e.prototype.scope_ended.call(n),o(t)},function(t){e.prototype.scope_ended.call(n),s(t)})})},function(t){e.prototype.scope_ended.call(n),s(t)})})},t.prototype.RemoveWebPartsFromFileIfSpecified=function(e,t,n){return new Promise(function(o,r){n||o();var i=t.get_webParts();e.load(i),e.executeQueryAsync(function(){i.get_data().forEach(function(e){e.deleteWebPart()}),e.load(i),e.executeQueryAsync(o,r)},r)})},t.prototype.GetWebPartXml=function(e){var t=this;return new Promise(function(n,o){var r=[];e.forEach(function(e,n){if(e.Contents.FileUrl){var o=i.Util.replaceUrlTokens(e.Contents.FileUrl);r.push(t.httpClient.fetchRaw(o).then(function(e){return e.text()}))}else r.push(function(){return new Promise(function(e,t){e()})}())}),Promise.all(r).then(function(t){t.forEach(function(t,n){var o=e[n];null!==o&&t&&t.length>0&&(o.Contents.Xml=t)}),n(e)})})},t.prototype.AddWebPartsToWebPartPage=function(e,t,n,o){var r=this;return new Promise(function(t,s){var a=SP.ClientContext.get_current(),c=a.get_web(),u=_spPageContextInfo.webServerRelativeUrl+"/"+e,l=c.getFileByServerRelativeUrl(u);a.load(l),a.executeQueryAsync(function(){var e=l.getLimitedWebPartManager(SP.WebParts.PersonalizationScope.shared);r.RemoveWebPartsFromFileIfSpecified(a,e,o).then(function(){r.GetWebPartXml(n).then(function(n){n.forEach(function(t){if(t.Contents.Xml){var n=e.importWebPart(i.Util.replaceUrlTokens(t.Contents.Xml)),o=n.get_webPart();e.addWebPart(o,t.Zone,t.Order)}}),a.executeQueryAsync(t,t)})})},t)})},t.prototype.ApplyFileProperties=function(e,t){return new Promise(function(n,o){var r=SP.ClientContext.get_current(),i=r.get_web(),s=_spPageContextInfo.webServerRelativeUrl+"/"+e,a=i.getFileByServerRelativeUrl(s),c=a.get_listItemAllFields();Object.keys(t).forEach(function(e){c.set_item(e,t[e])}),c.update(),r.executeQueryAsync(n,n)})},t.prototype.GetViewFromCollectionByUrl=function(e,t){for(var n=_spPageContextInfo.webServerRelativeUrl+"/"+t,o=e.getEnumerator();o.moveNext();){var r=o.get_current();if(r.get_serverRelativeUrl().toString().toLowerCase()===n.toLowerCase())return r}return null},t.prototype.ModifyHiddenViews=function(e){var t=this;return new Promise(function(n,o){var i=SP.ClientContext.get_current(),s=i.get_web(),a={},c=[],u=[];e.forEach(function(e){e.Views&&e.Views.forEach(function(t){a[t.List]=a[t.List]||[],a[t.List].push(r.Util.extend(t,{Url:e.Dest}))})}),Object.keys(a).forEach(function(e,t){c.push(s.get_lists().getByTitle(e)),u.push(s.get_lists().getByTitle(e).get_views()),i.load(c[t]),i.load(u[t])}),i.executeQueryAsync(function(){Object.keys(a).forEach(function(e,n){var o=a[e],r=c[n],s=u[n];o.forEach(function(e){var n=t.GetViewFromCollectionByUrl(s,e.Url);if(null!=n){if(e.Paged&&n.set_paged(e.Paged),e.Query&&n.set_viewQuery(e.Query),e.RowLimit&&n.set_rowLimit(e.RowLimit),e.ViewFields&&e.ViewFields.length>0){var o=n.get_viewFields();o.removeAll(),e.ViewFields.forEach(function(e){o.add(e)})}n.update()}}),i.load(s),r.update()}),i.executeQueryAsync(n,n)},n)})},t.prototype.GetFolderFromFilePath=function(e){var t=e.split("/");return t.splice(0,t.length-1).join("/")},t.prototype.GetFilenameFromFilePath=function(e){var t=e.split("/");return t[t.length-1]},t}(s.ObjectHandlerBase);n.ObjectFiles=a},{"../../../utils/util":23,"../util":20,"./objecthandlerbase":12}],12:[function(e,t,n){"use strict";var o=e("../../../net/httpclient"),r=e("../../../utils/logging"),i=function(){function e(e){this.name=e,this.httpClient=new o.HttpClient}return e.prototype.ProvisionObjects=function(e,t){return new Promise(function(e,t){e("Not implemented.")})},e.prototype.scope_started=function(){r.Logger.write(this.name+": Code execution scope started")},e.prototype.scope_ended=function(){r.Logger.write(this.name+": Code execution scope stopped")},e}();n.ObjectHandlerBase=i},{"../../../net/httpclient":5,"../../../utils/logging":22}],13:[function(e,t,n){"use strict";var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},r=e("../sequencer/sequencer"),i=e("./objecthandlerbase"),s=function(e){function t(){e.call(this,"Lists")}return o(t,e),t.prototype.ProvisionObjects=function(t){var n=this;return e.prototype.scope_started.call(this),new Promise(function(o,i){var s=SP.ClientContext.get_current(),a=s.get_web().get_lists(),c=[];s.load(a),s.executeQueryAsync(function(){t.forEach(function(e,t){var n=a.get_data().filter(function(t){return t.get_title()===e.Title})[0];if(n)e.Description&&n.set_description(e.Description),void 0!==e.EnableVersioning&&n.set_enableVersioning(e.EnableVersioning),void 0!==e.EnableMinorVersions&&n.set_enableMinorVersions(e.EnableMinorVersions),void 0!==e.EnableModeration&&n.set_enableModeration(e.EnableModeration),void 0!==e.EnableFolderCreation&&n.set_enableFolderCreation(e.EnableFolderCreation),void 0!==e.EnableAttachments&&n.set_enableAttachments(e.EnableAttachments),void 0!==e.NoCrawl&&n.set_noCrawl(e.NoCrawl),e.DefaultDisplayFormUrl&&n.set_defaultDisplayFormUrl(e.DefaultDisplayFormUrl),e.DefaultEditFormUrl&&n.set_defaultEditFormUrl(e.DefaultEditFormUrl),e.DefaultNewFormUrl&&n.set_defaultNewFormUrl(e.DefaultNewFormUrl),e.DraftVersionVisibility&&n.set_draftVersionVisibility(SP.DraftVisibilityType[e.DraftVersionVisibility]),e.ImageUrl&&n.set_imageUrl(e.ImageUrl),void 0!==e.Hidden&&n.set_hidden(e.Hidden),void 0!==e.ForceCheckout&&n.set_forceCheckout(e.ForceCheckout),n.update(),c.push(n),s.load(c[t]);else{var o=new SP.ListCreationInformation;if(e.Description&&o.set_description(e.Description),void 0!==e.OnQuickLaunch){var r=e.OnQuickLaunch?SP.QuickLaunchOptions.on:SP.QuickLaunchOptions.off;o.set_quickLaunchOption(r)}e.TemplateType&&o.set_templateType(e.TemplateType),e.Title&&o.set_title(e.Title),e.Url&&o.set_url(e.Url);var i=a.add(o);if(void 0!==e.EnableVersioning&&i.set_enableVersioning(e.EnableVersioning),void 0!==e.EnableMinorVersions&&i.set_enableMinorVersions(e.EnableMinorVersions),void 0!==e.EnableModeration&&i.set_enableModeration(e.EnableModeration),void 0!==e.EnableFolderCreation&&i.set_enableFolderCreation(e.EnableFolderCreation),void 0!==e.EnableAttachments&&i.set_enableAttachments(e.EnableAttachments),void 0!==e.NoCrawl&&i.set_noCrawl(e.NoCrawl),e.DefaultDisplayFormUrl&&i.set_defaultDisplayFormUrl(e.DefaultDisplayFormUrl),e.DefaultEditFormUrl&&i.set_defaultEditFormUrl(e.DefaultEditFormUrl),e.DefaultNewFormUrl&&i.set_defaultNewFormUrl(e.DefaultNewFormUrl),e.DraftVersionVisibility){var r=SP.DraftVisibilityType[e.DraftVersionVisibility.toLocaleLowerCase()];i.set_draftVersionVisibility(r)}e.ImageUrl&&i.set_imageUrl(e.ImageUrl),void 0!==e.Hidden&&i.set_hidden(e.Hidden),void 0!==e.ForceCheckout&&i.set_forceCheckout(e.ForceCheckout),c.push(i),s.load(c[t])}}),s.executeQueryAsync(function(){var i=new r.Sequencer([n.ApplyContentTypeBindings,n.ApplyListInstanceFieldRefs,n.ApplyFields,n.ApplyLookupFields,n.ApplyListSecurity,n.CreateViews,n.InsertDataRows,n.CreateFolders],{ClientContext:s,ListInstances:c,Objects:t},n);i.execute().then(function(){e.prototype.scope_ended.call(n),o()})},function(){e.prototype.scope_ended.call(n),o()})},function(){e.prototype.scope_ended.call(n),o()})})},t.prototype.EnsureLocationBasedMetadataDefaultsReceiver=function(e,t){var n=t.get_eventReceivers(),o=new SP.EventReceiverDefinitionCreationInformation;o.set_receiverName("LocationBasedMetadataDefaultsReceiver ItemAdded"),o.set_synchronization(1),o.set_sequenceNumber(1e3),o.set_receiverAssembly("Microsoft.Office.DocumentManagement, Version=15.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c"),o.set_receiverClass("Microsoft.Office.DocumentManagement.LocationBasedMetadataDefaultsReceiver"),o.set_eventType(SP.EventReceiverType.itemAdded),n.add(o),t.update()},t.prototype.CreateFolders=function(e){var t=this;return new Promise(function(n,o){e.ListInstances.forEach(function(n,o){var r=e.Objects[o];if(r.Folders){var i=_spPageContextInfo.webServerRelativeUrl+"/"+r.Url,s=n.get_rootFolder(),a="<MetadataDefaults>",c=!1;if(r.Folders.forEach(function(e){var t=i+"/"+e.Name;if(s.get_folders().add(t),e.DefaultValues){var n=Object.keys(e.DefaultValues).length;n>0&&(a+="<a href='"+t+"'>",Object.keys(e.DefaultValues).forEach(function(t){a+='<DefaultValue FieldName="'+t+'">'+e.DefaultValues[t]+"</DefaultValue>"}),a+="</a>"),c=!0}}),a+="</MetadataDefaults>",c){var u=new SP.FileCreationInformation;u.set_url(i+"/Forms/client_LocationBasedDefaults.html"),u.set_content(new SP.Base64EncodedByteArray),u.set_overwrite(!0);for(var l=0;l<a.length;l++)u.get_content().append(a.charCodeAt(l));s.get_files().add(u),t.EnsureLocationBasedMetadataDefaultsReceiver(e.ClientContext,n)}}}),e.ClientContext.executeQueryAsync(n,n)})},t.prototype.ApplyContentTypeBindings=function(e){return new Promise(function(t,n){var o=e.ClientContext.get_site().get_rootWeb().get_contentTypes(),r=[];e.ListInstances.forEach(function(t,n){r.push(t.get_contentTypes()),e.ClientContext.load(r[n],"Include(Name,Id)"),e.Objects[n].ContentTypeBindings&&(t.set_contentTypesEnabled(!0),t.update())}),e.ClientContext.load(o),e.ClientContext.executeQueryAsync(function(){e.ListInstances.forEach(function(t,n){var i=e.Objects[n];if(i.ContentTypeBindings){var s=r[n],a=new Array;if(i.RemoveExistingContentTypes&&i.ContentTypeBindings.length>0&&s.get_data().forEach(function(e){a.push(e)}),i.ContentTypeBindings.forEach(function(e){s.addExistingContentType(o.getById(e.ContentTypeId))}),i.RemoveExistingContentTypes&&i.ContentTypeBindings.length>0)for(var c=0;c<a.length;c++){var u=a[c];u.deleteObject()}t.update()}}),e.ClientContext.executeQueryAsync(t,t)},t)})},t.prototype.ApplyListInstanceFieldRefs=function(e){return new Promise(function(t,n){var o=e.ClientContext.get_site().get_rootWeb().get_fields();e.ListInstances.forEach(function(t,n){var r=e.Objects[n];r.FieldRefs&&(r.FieldRefs.forEach(function(e){var n=o.getByInternalNameOrTitle(e.Name);t.get_fields().add(n)}),t.update())}),e.ClientContext.executeQueryAsync(t,t)})},t.prototype.ApplyFields=function(e){var t=this;return new Promise(function(n,o){e.ListInstances.forEach(function(n,o){var r=e.Objects[o];r.Fields&&(r.Fields.forEach(function(o){var r=t.GetFieldXml(o,e.ListInstances,n),i=t.GetFieldXmlAttr(r,"Type");"Lookup"!==i&&"LookupMulti"!==i&&n.get_fields().addFieldAsXml(r,!0,SP.AddFieldOptions.addToAllContentTypes)}),n.update())}),e.ClientContext.executeQueryAsync(n,n)})},t.prototype.ApplyLookupFields=function(e){var t=this;return new Promise(function(n,o){e.ListInstances.forEach(function(n,o){var r=e.Objects[o];r.Fields&&(r.Fields.forEach(function(o){var r=t.GetFieldXml(o,e.ListInstances,n);if(r){var i=t.GetFieldXmlAttr(r,"Type");"Lookup"!==i&&"LookupMulti"!==i||n.get_fields().addFieldAsXml(r,!0,SP.AddFieldOptions.addToAllContentTypes)}}),n.update())}),e.ClientContext.executeQueryAsync(n,n)})},t.prototype.GetFieldXmlAttr=function(e,t){var n=new RegExp(t+"=['|\"](?:(.+?))['|\"]"),o=n.exec(e);return o[1]},t.prototype.GetFieldXml=function(e,t,n){var o="";if(!e.SchemaXml){var r=[];Object.keys(e).forEach(function(n){var o=e[n];if(r.push(n+'="'+o+'"'),"List"===n){var i=t.filter(function(e){return e.get_title()===o});if(!(i.length>0))return null;o="{"+i[0].get_id().toString()+"}"}}),o="<Field "+r.join(" ")+">","Calculated"===e.Type&&(o+="<Formula>"+e.Formula+"</Formula>"),o+="</Field>"}return o},t.prototype.ApplyListSecurity=function(e){return new Promise(function(t,n){e.ListInstances.forEach(function(t,n){var o=e.Objects[n];o.Security&&o.Security.BreakRoleInheritance&&(t.breakRoleInheritance(o.Security.CopyRoleAssignments,o.Security.ClearSubscopes),t.update(),e.ClientContext.load(t.get_roleAssignments()))});var o=e.ClientContext.get_web(),r=o.get_allProperties(),i=o.get_siteGroups(),s=o.get_roleDefinitions();e.ClientContext.load(r),e.ClientContext.load(s),e.ClientContext.executeQueryAsync(function(){e.ListInstances.forEach(function(t,n){var o=e.Objects[n];o.Security&&(o.Security.RoleAssignments.forEach(function(n){var o=null;o="number"==typeof n.RoleDefinition?s.getById(n.RoleDefinition):s.getByName(n.RoleDefinition);var a=SP.RoleDefinitionBindingCollection.newObject(e.ClientContext);a.add(o);var c=null;if(n.Principal.match(/\{[A-Za-z]*\}+/g)){var u=n.Principal.substring(1,n.Principal.length-1),l=r.get_fieldValues()["vti_"+u];c=i.getById(l)}else c=i.getByName(c);t.get_roleAssignments().add(c,a)}),t.update())}),e.ClientContext.executeQueryAsync(t,t)},t)})},t.prototype.CreateViews=function(e){return new Promise(function(t,n){var o=[];e.ListInstances.forEach(function(t,n){o.push(t.get_views()),e.ClientContext.load(o[n])}),e.ClientContext.executeQueryAsync(function(){e.ListInstances.forEach(function(t,n){var r=e.Objects[n];r.Views&&(o.push(t.get_views()),e.ClientContext.load(o[n]),r.Views.forEach(function(i){var s=o[n].get_data().filter(function(e){return r.RemoveExistingViews&&r.Views.length>0?(e.deleteObject(),!1):e.get_title()===i.Title}).length>0;if(s){var a=o[n].getByTitle(i.Title);if(i.Paged&&a.set_paged(i.Paged),i.Query&&a.set_viewQuery(i.Query),i.RowLimit&&a.set_rowLimit(i.RowLimit),i.ViewFields&&i.ViewFields.length>0){var c=a.get_viewFields();c.removeAll(),i.ViewFields.forEach(function(e){c.add(e)})}i.Scope&&a.set_scope(i.Scope),a.update()}else{var u=new SP.ViewCreationInformation;i.Title&&u.set_title(i.Title),i.PersonalView&&u.set_personalView(i.PersonalView),i.Paged&&u.set_paged(i.Paged),i.Query&&u.set_query(i.Query),i.RowLimit&&u.set_rowLimit(i.RowLimit),i.SetAsDefaultView&&u.set_setAsDefaultView(i.SetAsDefaultView),i.ViewFields&&u.set_viewFields(i.ViewFields),i.ViewTypeKind&&u.set_viewTypeKind(SP.ViewType.html);var a=t.get_views().add(u);i.Scope&&(a.set_scope(i.Scope),a.update()),t.update()}e.ClientContext.load(t.get_views())}))}),e.ClientContext.executeQueryAsync(t,t)},t)})},t.prototype.InsertDataRows=function(e){return new Promise(function(t,n){e.ListInstances.forEach(function(t,n){var o=e.Objects[n];o.DataRows&&o.DataRows.forEach(function(n){var o=t.addItem(new SP.ListItemCreationInformation);Object.keys(n).forEach(function(e){o.set_item(e,n[e])}),o.update(),e.ClientContext.load(o)})}),e.ClientContext.executeQueryAsync(t,t)})},t}(i.ObjectHandlerBase);n.ObjectLists=s},{"../sequencer/sequencer":19,"./objecthandlerbase":12}],14:[function(e,t,n){"use strict";var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},r=e("../util"),i=e("./objecthandlerbase"),s=function(e){function t(){e.call(this,"Navigation")}return o(t,e),t.prototype.ProvisionObjects=function(t){var n=this;e.prototype.scope_started.call(this);var o=SP.ClientContext.get_current(),r=o.get_web().get_navigation();return new Promise(function(i,s){n.ConfigureQuickLaunch(t.QuickLaunch,o,n.httpClient,r).then(function(){e.prototype.scope_ended.call(n),i()},function(){e.prototype.scope_ended.call(n),s()})})},t.prototype.getNodeFromCollectionByTitle=function(e,t){var n=e.filter(function(e){return e.get_title()===t});return n[0]||null},t.prototype.ConfigureQuickLaunch=function(e,t,n,o){var i=this;return new Promise(function(s,a){if(0===e.length)s();else{var c=o.get_quickLaunch();t.load(c),t.executeQueryAsync(function(){for(var a=[],u=c.get_count()-1;u>=0;){var l=c.itemAt(u);a.push(l),l.deleteObject(),u--}t.executeQueryAsync(function(){e.forEach(function(e){var t=i.getNodeFromCollectionByTitle(a,e.Title),n=new SP.NavigationNodeCreationInformation;n.set_title(e.Title),n.set_url(t?t.get_url():r.Util.replaceUrlTokens(e.Url)),n.set_asLastNode(!0),c.add(n)}),t.executeQueryAsync(function(){n.get(_spPageContextInfo.webAbsoluteUrl+"/_api/web/Navigation/QuickLaunch").then(function(n){n.json().then(function(n){n.value.forEach(function(t){var n=o.getNodeById(t.Id),s=n.get_children(),c=e.filter(function(e){return e.Title===t.Title})[0];c&&c.Children&&c.Children.forEach(function(e){var t=i.getNodeFromCollectionByTitle(a,e.Title),n=new SP.NavigationNodeCreationInformation;n.set_title(e.Title),n.set_url(t?t.get_url():r.Util.replaceUrlTokens(e.Url)),n.set_asLastNode(!0),s.add(n)})}),t.executeQueryAsync(s,s)})})},s)})})}})},t}(i.ObjectHandlerBase);n.ObjectNavigation=s},{"../util":20,"./objecthandlerbase":12}],15:[function(e,t,n){"use strict";var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},r=e("../util"),i=e("./objecthandlerbase"),s=function(e){function t(){e.call(this,"PropertyBagEntries")}return o(t,e),t.prototype.ProvisionObjects=function(t){var n=this;return e.prototype.scope_started.call(this),new Promise(function(o,i){if(t&&0!==t.length){for(var s=SP.ClientContext.get_current(),a=s.get_web(),c=a.get_allProperties(),u=[],l=0;l<t.length;l++){var p=t[l];c.set_item(p.Key,p.Value),p.Indexed&&u.push(r.Util.encodePropertyKey(p.Key))}a.update(),s.load(c),s.executeQueryAsync(function(){u.length>0?(c.set_item("vti_indexedpropertykeys",u.join("|")),a.update(),s.executeQueryAsync(function(){e.prototype.scope_ended.call(n),o()},function(){e.prototype.scope_ended.call(n),o()})):(e.prototype.scope_ended.call(n),o())},function(){e.prototype.scope_ended.call(n),o()})}else o()})},t}(i.ObjectHandlerBase);n.ObjectPropertyBagEntries=s},{"../util":20,"./objecthandlerbase":12}],16:[function(e,t,n){"use strict";var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},r=e("./objecthandlerbase"),i=function(e){
function t(){e.call(this,"WebSettings")}return o(t,e),t.prototype.ProvisionObjects=function(t){var n=this;return e.prototype.scope_started.call(this),new Promise(function(o,r){var i=SP.ClientContext.get_current(),s=i.get_web();t.WelcomePage&&(s.get_rootFolder().set_welcomePage(t.WelcomePage),s.get_rootFolder().update()),t.MasterUrl&&s.set_masterUrl(t.MasterUrl),t.CustomMasterUrl&&s.set_customMasterUrl(t.CustomMasterUrl),void 0!==t.SaveSiteAsTemplateEnabled&&s.set_saveSiteAsTemplateEnabled(t.SaveSiteAsTemplateEnabled),void 0!==t.QuickLaunchEnabled&&s.set_saveSiteAsTemplateEnabled(t.QuickLaunchEnabled),void 0!==t.TreeViewEnabled&&s.set_treeViewEnabled(t.TreeViewEnabled),s.update(),i.load(s),i.executeQueryAsync(function(){e.prototype.scope_ended.call(n),o()},function(){e.prototype.scope_ended.call(n),o()})})},t}(r.ObjectHandlerBase);n.ObjectWebSettings=i},{"./objecthandlerbase":12}],17:[function(e,t,n){"use strict";var o=e("./provisioningstep"),r=e("./objecthandlers/objectnavigation"),i=e("./objecthandlers/objectpropertybagentries"),s=e("./objecthandlers/objectfeatures"),a=e("./objecthandlers/objectwebsettings"),c=e("./objecthandlers/objectcomposedlook"),u=e("./objecthandlers/objectcustomactions"),l=e("./objecthandlers/objectfiles"),p=e("./objecthandlers/objectlists"),f=e("./util"),d=e("../../utils/logging"),h=e("../../net/httpclient"),g=function(){function e(){this.handlers={Navigation:r.ObjectNavigation,PropertyBagEntries:i.ObjectPropertyBagEntries,Features:s.ObjectFeatures,WebSettings:a.ObjectWebSettings,ComposedLook:c.ObjectComposedLook,CustomActions:u.ObjectCustomActions,Files:l.ObjectFiles,Lists:p.ObjectLists},this.httpClient=new h.HttpClient}return e.prototype.applyTemplate=function(e){var t=this,n=f.Util.replaceUrlTokens(e);return new Promise(function(e,o){t.httpClient.get(n).then(function(n){n.ok?n.json().then(function(n){t.start(n,Object.keys(n)).then(e,o)}):o(n.statusText)},function(e){d.Logger.write("Provisioning: The provided template is invalid",d.LogLevel.Error)})})},e.prototype.start=function(e,t){var n=this;return new Promise(function(r,i){n.startTime=(new Date).getTime(),n.queueItems=[],t.forEach(function(t,r){n.handlers[t]&&n.queueItems.push(new o.ProvisioningStep(t,r,e[t],e.Parameters,n.handlers[t]))});var s=[];s.push(new Promise(function(e){d.Logger.write("Provisioning: Code execution scope started",d.LogLevel.Info),e()}));for(var a=1;void 0!==n.queueItems[a-1];){var c=s.length-1;s.push(n.queueItems[a-1].execute(s[c])),a++}Promise.all(s).then(function(e){d.Logger.write("Provisioning: Code execution scope ended",d.LogLevel.Info),r(e)},function(e){d.Logger.write("Provisioning: Code execution scope ended"+JSON.stringify(e),d.LogLevel.Error),i(e)})})},e}();n.Provisioning=g},{"../../net/httpclient":5,"../../utils/logging":22,"./objecthandlers/objectcomposedlook":8,"./objecthandlers/objectcustomactions":9,"./objecthandlers/objectfeatures":10,"./objecthandlers/objectfiles":11,"./objecthandlers/objectlists":13,"./objecthandlers/objectnavigation":14,"./objecthandlers/objectpropertybagentries":15,"./objecthandlers/objectwebsettings":16,"./provisioningstep":18,"./util":20}],18:[function(e,t,n){"use strict";var o=function(){function e(e,t,n,o,r){this.name=e,this.index=t,this.objects=n,this.parameters=o,this.handler=r}return e.prototype.execute=function(e){var t=this,n=new this.handler;return e?new Promise(function(o,r){e.then(function(){return n.ProvisionObjects(t.objects,t.parameters).then(o,o)})}):n.ProvisionObjects(this.objects,this.parameters)},e}();n.ProvisioningStep=o},{}],19:[function(e,t,n){"use strict";var o=function(){function e(e,t,n){this.functions=e,this.parameter=t,this.scope=n}return e.prototype.execute=function(e){var t=this,n=Promise.resolve();return this.functions.forEach(function(o,r){n=n.then(function(){return o.call(t.scope,t.parameter)}).then(function(n){e&&e.call(t,r,t.functions)})},this),n},e}();n.Sequencer=o},{}],20:[function(e,t,n){"use strict";var o=function(){function e(){}return e.getRelativeUrl=function(e){return e.replace(document.location.protocol+"//"+document.location.hostname,"")},e.replaceUrlTokens=function(e){return e.replace(/{site}/g,_spPageContextInfo.webAbsoluteUrl).replace(/{sitecollection}/g,_spPageContextInfo.siteAbsoluteUrl).replace(/{themegallery}/g,_spPageContextInfo.siteAbsoluteUrl+"/_catalogs/theme/15")},e.encodePropertyKey=function(e){for(var t=[],n=0;n<e.length;++n)t.push(e.charCodeAt(n)),t.push(0);var o=window.btoa(String.fromCharCode.apply(null,t));return o},e}();n.Util=o},{}],21:[function(e,t,n){"use strict";function o(e){if(e.hasOwnProperty("odata.id"))return e["odata.id"];if(e.hasOwnProperty("__metadata")&&e.__metadata.hasOwnProperty("id"))return e.__metadata.id;throw l.Logger.log({data:e,level:l.LogLevel.Error,message:"Could not extract odata id in object, you may be using nometadata. Object data logged to logger."}),new Error("Could not extract odata id in object, you may be using nometadata. Object data logged to logger.")}function r(e){return e.hasOwnProperty("__metadata")?e.__metadata.uri:e.hasOwnProperty("odata.editLink")?u.Util.combinePaths("_api",e["odata.editLink"]):(l.Logger.write("No uri information found in ODataEntity parsing, chaining will fail for this object.",l.LogLevel.Warning),"")}function i(){return new y}function s(e){return new v(e)}function a(e){return new b(e)}var c=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},u=e("../../utils/util"),l=e("../../utils/logging"),p=e("../../net/httpclient"),f=e("../../configuration/pnplibconfig");n.extractOdataId=o;var d=function(){function e(){}return e.prototype.parse=function(e){var t=this;return e.json().then(function(e){return t.parseODataJSON(e)})},e.prototype.parseODataJSON=function(e){var t=e;return e.hasOwnProperty("d")?t=e.d.hasOwnProperty("results")?e.d.results:e.d:e.hasOwnProperty("value")&&(t=e.value),t},e}();n.ODataParserBase=d;var h=function(e){function t(){e.apply(this,arguments)}return c(t,e),t}(d);n.ODataDefaultParser=h;var g=function(){function e(){}return e.prototype.parse=function(e){return e.json()},e}();n.ODataRawParserImpl=g;var y=function(e){function t(){e.apply(this,arguments)}return c(t,e),t.prototype.parse=function(t){return e.prototype.parse.call(this,t).then(function(e){return e})},t}(d),v=function(e){function t(t){e.call(this),this.factory=t}return c(t,e),t.prototype.parse=function(t){var n=this;return e.prototype.parse.call(this,t).then(function(e){var t=new n.factory(r(e),null);return u.Util.extend(t,e)})},t}(d),b=function(e){function t(t){e.call(this),this.factory=t}return c(t,e),t.prototype.parse=function(t){var n=this;return e.prototype.parse.call(this,t).then(function(e){return e.map(function(e){var t=new n.factory(r(e),null);return u.Util.extend(t,e)})})},t}(d);n.ODataRaw=new g,n.ODataValue=i,n.ODataEntity=s,n.ODataEntityArray=a;var m=function(){function e(e,t){void 0===t&&(t=u.Util.getGUID()),this.baseUrl=e,this._batchId=t,this._requests=[],this._batchDependencies=Promise.resolve()}return e.prototype.add=function(e,t,n,o){var r={method:t.toUpperCase(),options:n,parser:o,reject:null,resolve:null,url:e},i=new Promise(function(e,t){r.resolve=e,r.reject=t});return this._requests.push(r),i},e.prototype.addBatchDependency=function(){var e,t=new Promise(function(t){e=t});return this._batchDependencies=this._batchDependencies.then(function(){return t}),e},e.prototype.execute=function(){var e=this;return this._batchDependencies.then(function(){return e.executeImpl()})},e.prototype.executeImpl=function(){var e=this;if(this._requests.length<1)return Promise.resolve();var t=[],n="";this._requests.forEach(function(o,r){"GET"===o.method?(n.length>0&&(t.push("--changeset_"+n+"--\n\n"),n=""),t.push("--batch_"+e._batchId+"\n")):(n.length<1&&(n=u.Util.getGUID(),t.push("--batch_"+e._batchId+"\n"),t.push('Content-Type: multipart/mixed; boundary="changeset_'+n+'"\n\n')),t.push("--changeset_"+n+"\n")),t.push("Content-Type: application/http\n"),t.push("Content-Transfer-Encoding: binary\n\n");var i={Accept:"application/json;"};if("GET"!==o.method){var s=o.method;o.options&&o.options.headers&&"undefined"!==o.options.headers["X-HTTP-Method"]&&(s=o.options.headers["X-HTTP-Method"],delete o.options.headers["X-HTTP-Method"]),t.push(s+" "+o.url+" HTTP/1.1\n"),i=u.Util.extend(i,{"Content-Type":"application/json;odata=verbose;charset=utf-8"})}else t.push(o.method+" "+o.url+" HTTP/1.1\n");"undefined"!=typeof f.RuntimeConfig.headers&&(i=u.Util.extend(i,f.RuntimeConfig.headers)),o.options&&o.options.headers&&(i=u.Util.extend(i,o.options.headers));for(var a in i)i.hasOwnProperty(a)&&t.push(a+": "+i[a]+"\n");t.push("\n"),o.options.body&&t.push(o.options.body+"\n\n")}),n.length>0&&(t.push("--changeset_"+n+"--\n\n"),n=""),t.push("--batch_"+this._batchId+"--\n");var o={"Content-Type":"multipart/mixed; boundary=batch_"+this._batchId},r={body:t.join(""),headers:o},i=new p.HttpClient,s=u.Util.makeUrlAbsolute(u.Util.combinePaths(this.baseUrl,"/_api/$batch"));return i.post(s,r).then(function(e){return e.text()}).then(this._parseResponse).then(function(t){if(t.length!==e._requests.length)throw new Error("Could not properly parse responses to match requests in batch.");for(var n=Promise.resolve(),o=function(o){var r=e._requests[o],i=t[o];i.ok||r.reject(new Error(i.statusText)),n=n.then(function(e){return r.parser.parse(i).then(r.resolve).catch(r.reject)})},r=0;r<t.length;r++)o(r);return n})},e.prototype._parseResponse=function(e){return new Promise(function(t,n){for(var o,r,i=[],s="--batchresponse_",a=new RegExp("^HTTP/[0-9.]+ +([0-9]+) +(.*)","i"),c=e.split("\n"),u="batch",l=0;l<c.length;++l){var p=c[l];switch(u){case"batch":if(p.substr(0,s.length)===s)u="batchHeaders";else if(""!==p.trim())throw new Error("Invalid response, line "+l);break;case"batchHeaders":""===p.trim()&&(u="status");break;case"status":var f=a.exec(p);if(3!==f.length)throw new Error("Invalid status, line "+l);o=parseInt(f[1],10),r=f[2],u="statusHeaders";break;case"statusHeaders":""===p.trim()&&(u="body");break;case"body":var d=void 0;d=204===o?new Response:new Response(p,{status:o,statusText:r}),i.push(d),u="batch"}}"status"!==u&&n(new Error("Unexpected end of input")),t(i)})},e}();n.ODataBatch=m},{"../../configuration/pnplibconfig":2,"../../net/httpclient":5,"../../utils/logging":22,"../../utils/util":23}],22:[function(e,t,n){"use strict";!function(e){e[e.Verbose=0]="Verbose",e[e.Info=1]="Info",e[e.Warning=2]="Warning",e[e.Error=3]="Error",e[e.Off=99]="Off"}(n.LogLevel||(n.LogLevel={}));var o=n.LogLevel,r=function(){function e(){}return Object.defineProperty(e,"activeLogLevel",{get:function(){return e.instance.activeLogLevel},set:function(t){e.instance.activeLogLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(e,"instance",{get:function(){return"undefined"!=typeof e._instance&&null!==e._instance||(e._instance=new i),e._instance},enumerable:!0,configurable:!0}),e.subscribe=function(){for(var t=[],n=0;n<arguments.length;n++)t[n-0]=arguments[n];for(var o=0;o<t.length;o++)e.instance.subscribe(t[o])},e.clearSubscribers=function(){return e.instance.clearSubscribers()},Object.defineProperty(e,"count",{get:function(){return e.instance.count},enumerable:!0,configurable:!0}),e.write=function(t,n){void 0===n&&(n=o.Verbose),e.instance.log({level:n,message:t})},e.log=function(t){e.instance.log(t)},e.measure=function(t,n){return e.instance.measure(t,n)},e}();n.Logger=r;var i=function(){function e(e,t){void 0===e&&(e=o.Warning),void 0===t&&(t=[]),this.activeLogLevel=e,this.subscribers=t}return e.prototype.subscribe=function(e){this.subscribers.push(e)},e.prototype.clearSubscribers=function(){var e=this.subscribers.slice(0);return this.subscribers.length=0,e},Object.defineProperty(e.prototype,"count",{get:function(){return this.subscribers.length},enumerable:!0,configurable:!0}),e.prototype.write=function(e,t){void 0===t&&(t=o.Verbose),this.log({level:t,message:e})},e.prototype.log=function(e){if(!("undefined"==typeof e||e.level<this.activeLogLevel))for(var t=0;t<this.subscribers.length;t++)this.subscribers[t].log(e)},e.prototype.measure=function(e,t){console.profile(e);try{return t()}finally{console.profileEnd()}},e}(),s=function(){function e(){}return e.prototype.log=function(e){var t=this.format(e);switch(e.level){case o.Verbose:case o.Info:console.log(t);break;case o.Warning:console.warn(t);break;case o.Error:console.error(t)}},e.prototype.format=function(e){return"Message: "+e.message+". Data: "+JSON.stringify(e.data)},e}();n.ConsoleListener=s;var a=function(){function e(e){this.azureInsightsInstrumentationKey=e;var t=window.appInsights||function(e){function t(e){r[e]=function(){var t=arguments;r.queue.push(function(){r[e].apply(r,t)})}}var n,o,r={config:e},i=document,s=window,a="script",c=i.createElement(a);for(c.src=e.url||"//az416426.vo.msecnd.net/scripts/a/ai.0.js",i.getElementsByTagName(a)[0].parentNode.appendChild(c),r.cookie=i.cookie,r.queue=[],n=["Event","Exception","Metric","PageView","Trace"];n.length;)t("track"+n.pop());return t("setAuthenticatedUserContext"),t("clearAuthenticatedUserContext"),e.disableExceptionTracking||(n="onerror",t("_"+n),o=s[n],s[n]=function(e,t,i,s,a){var c=o&&o(e,t,i,s,a);return c!==!0&&r["_"+n](e,t,i,s,a),c}),r}({instrumentationKey:this.azureInsightsInstrumentationKey});window.appInsights=t}return e.prototype.log=function(e){var t=window.appInsights,n=this.format(e);e.level===o.Error?t.trackException(n):t.trackEvent(n)},e.prototype.format=function(e){return"Message: "+e.message+". Data: "+JSON.stringify(e.data)},e}();n.AzureInsightsListener=a;var c=function(){function e(e){this.method=e}return e.prototype.log=function(e){this.method(e)},e}();n.FunctionListener=c},{}],23:[function(e,t,n){(function(e){"use strict";var t=function(){function t(){}return t.getCtxCallback=function(e,t){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];return function(){t.apply(e,n)}},t.urlParamExists=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)");return t.test(location.search)},t.getUrlParamByName=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)"),n=t.exec(location.search);return null==n?"":decodeURIComponent(n[1].replace(/\+/g," "))},t.getUrlParamBoolByName=function(e){var t=this.getUrlParamByName(e),n=""===t||/false|0/i.test(t);return!n},t.stringInsert=function(e,t,n){return t>0?e.substring(0,t)+n+e.substring(t,e.length):n+e},t.dateAdd=function(e,t,n){var o=new Date(e.toLocaleString());switch(t.toLowerCase()){case"year":o.setFullYear(o.getFullYear()+n);break;case"quarter":o.setMonth(o.getMonth()+3*n);break;case"month":o.setMonth(o.getMonth()+n);break;case"week":o.setDate(o.getDate()+7*n);break;case"day":o.setDate(o.getDate()+n);break;case"hour":o.setTime(o.getTime()+36e5*n);break;case"minute":o.setTime(o.getTime()+6e4*n);break;case"second":o.setTime(o.getTime()+1e3*n);break;default:o=void 0}return o},t.loadStylesheet=function(e,t){t&&(e+="?"+encodeURIComponent((new Date).getTime().toString()));var n=document.getElementsByTagName("head");if(n.length>0){var o=document.createElement("link");n[0].appendChild(o),o.setAttribute("type","text/css"),o.setAttribute("rel","stylesheet"),o.setAttribute("href",e)}},t.combinePaths=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];for(var n=[],o=0;o<e.length;o++)"undefined"!=typeof e[o]&&null!==e[o]&&n.push(e[o].replace(/^[\\|\/]/,"").replace(/[\\|\/]$/,""));return n.join("/").replace(/\\/,"/")},t.getRandomString=function(e){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=0;o<e;o++)t+=n.charAt(Math.floor(Math.random()*n.length));return t},t.getGUID=function(){var e=(new Date).getTime(),t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)});return t},t.isFunction=function(e){return"function"==typeof e},t.isArray=function(e){return Array.isArray?Array.isArray(e):e&&"number"==typeof e.length&&e.constructor===Array},t.stringIsNullOrEmpty=function(e){return"undefined"==typeof e||null===e||""===e},t.extend=function(e,t,n){void 0===n&&(n=!1);var o={};for(var r in e)o[r]=e[r];var i=n?function(e,t){return!e.hasOwnProperty(t)}:function(e,t){return!0};for(var r in t)i(o,r)&&(o[r]=t[r]);return o},t.applyMixins=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];t.forEach(function(t){Object.getOwnPropertyNames(t.prototype).forEach(function(n){e.prototype[n]=t.prototype[n]})})},t.isUrlAbsolute=function(e){return/^https?:\/\/|^\/\//i.test(e)},t.makeUrlAbsolute=function(n){return t.isUrlAbsolute(n)?n:"undefined"==typeof e._spPageContextInfo?n:e._spPageContextInfo.hasOwnProperty("webAbsoluteUrl")?t.combinePaths(e._spPageContextInfo.webAbsoluteUrl,n):e._spPageContextInfo.hasOwnProperty("webServerRelativeUrl")?t.combinePaths(e._spPageContextInfo.webServerRelativeUrl,n):void 0},t}();n.Util=t}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[17])(17)});
//# sourceMappingURL=pnp-provisioning.min.js.map
